# ============================================
# TMUX CONFIG - TESTED & WORKING
# ============================================

# Core settings
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on
set -g mouse on
set -sg escape-time 0
set -g focus-events on
set -g set-clipboard on
set -g mode-keys vi

# Prefix key (Ctrl+b by default)
set -g prefix C-b
unbind C-b
bind C-b send-prefix

# Quick config reload
unbind r
bind r source-file ~/.tmux.conf \; display "Config reloaded"

# ============================================
# NEW SESSION KEYBINDINGS - GUARANTEED WORKING
# ============================================

# CREATE NEW SESSION - Ctrl+b C
bind C new-session -c "#{pane_current_path}"

# CREATE SESSION WITH NAME - Ctrl+b s
bind s command-prompt -p "Session name:" "new-session -s '%%'"

# CREATE SESSION FROM HOME - Ctrl+b H
bind H new-session -c ~

# CREATE SESSION IN PROJECTS - Ctrl+b P
bind P new-session -c ~/projects

# ============================================
# NAVIGATION KEYBINDINGS
# ============================================

# Switch sessions - Ctrl+b f
bind f command-prompt -p "Switch to session:" "switch-client -t '%%'"

# Previous session - Ctrl+b (
bind ( switch-client -p

# Next session - Ctrl+b )
bind ) switch-client -n

# List sessions - Ctrl+b L
bind L choose-tree -s

# Kill current session - Ctrl+b X
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ============================================
# PANE MANAGEMENT
# ============================================

# Split panes - Ctrl+b | and Ctrl+b -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Vim-style navigation - Ctrl+b then hjkl
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes
bind -r H resize-pane -L 5
bind -r L resize-pane -R 5
bind -r K resize-pane -U 5
bind -r J resize-pane -D 5

# Zoom pane - Ctrl+b z
bind z resize-pane -Z

# Swap panes
bind > swap-pane -D
bind < swap-pane -U

# ============================================
# WINDOW MANAGEMENT
# ============================================

# New window - Ctrl+b c
bind c new-window -c "#{pane_current_path}"

# Next window - Ctrl+b n
bind n next-window

# Previous window - Ctrl+b p
bind p previous-window

# Rename window - Ctrl+b ,
bind , command-prompt -p "Rename window:" "rename-window '%%'"

# Kill window - Ctrl+b &
bind & kill-window

# List windows - Ctrl+b w
bind w choose-tree -w

# ============================================
# STATUS BAR & THEME
# ============================================

set -g status on
set -g status-position bottom
set -g status-interval 1
set -g status-justify left
set -g status-style "bg=black,fg=white"

set -g status-left-length 100
set -g status-right-length 100

set -g status-left "#[fg=green]#S #[fg=yellow]#I:#P"
set -g status-right "#[fg=cyan]%Y-%m-%d %H:%M"

setw -g window-status-format "#[fg=white]#I:#W"
setw -g window-status-current-format "#[fg=yellow,bold]#I:#W"

# Pane borders
set -g pane-border-style "fg=blue"
set -g pane-active-border-style "fg=yellow"

# ============================================
# COPY MODE (VI STYLE)
# ============================================

# Enter copy mode - Ctrl+b [
bind [ copy-mode

# Copy selection - v to select, y to copy
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel

# Search in copy mode - /
bind-key -T copy-mode-vi / command-prompt -p "Search:" "send -X search-forward-incremental \"%%\""

# ============================================
# UTILITIES
# ============================================

# Display pane numbers - Ctrl+b q
bind q display-panes

# Toggle status bar - Ctrl+b b
bind b set-option status

# Choose buffer to paste - Ctrl+b =
bind = choose-buffer

# Synchronize panes - Ctrl+b :setw synchronize-panes
bind y set-window-option synchronize-panes

# ============================================
# HELP MENU
# ============================================

# Show key bindings - Ctrl+b ?
bind ? list-keys

# Quick reference
bind M display-message "
SESSION MANAGEMENT:
C       New session in current dir
s       New session with name
f       Switch to session
( )     Previous/next session
L       List all sessions
X       Kill current session

WINDOWS:
c       New window
n/p     Next/previous window
,       Rename window
&       Kill window
w       List windows

PANES:
| -     Split horizontally/vertically
hjkl    Navigate panes
H/L/K/J Resize panes
z       Zoom pane
> <     Swap panes

OTHER:
?       Show all keybindings
r       Reload config
q       Show pane numbers
"

# ============================================
# FZF INTEGRATION (OPTIONAL)
# ============================================

# If fzf is installed, add these extras
if-shell 'command -v fzf >/dev/null' '
  # Fuzzy find sessions - Ctrl+b F
  bind F run-shell "tmux list-sessions -F \"#{session_name}\" | fzf --reverse | xargs tmux switch-client -t"
  
  # Fuzzy create session from directory - Ctrl+b D
  bind D run-shell "find ~/ -type d 2>/dev/null | fzf --reverse | xargs -I {} tmux new-session -c {} -s $(basename {} | tr \" \" _)"
  
  # Fuzzy kill sessions - Ctrl+b K
  bind K run-shell "tmux list-sessions -F \"#{session_name}\" | fzf -m --reverse | xargs -I {} tmux kill-session -t {}"
'

# ============================================
# PLUGINS (TPM)
# ============================================

# Install TPM first: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -g @continuum-restore 'on'
set -g @resurrect-capture-pane-contents 'on'

# Initialize TPM (must be at bottom)
run '~/.tmux/plugins/tpm/tpm'
#EOF
